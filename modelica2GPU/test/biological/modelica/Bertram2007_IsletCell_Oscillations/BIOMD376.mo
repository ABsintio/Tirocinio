
model BIOMD376 "Bertram2007_IsletCell_Oscillations"

    function pow
        input  Real x;
        input  Real power;
        output Real y;
        algorithm
            y := x^power;
    end pow;
    
    function piecewise
        input Real x;
        input Boolean condition;
        input Real y;
        output Real z;
        algorithm
            z := if condition then x else y;
    end piecewise;



    parameter Real cm = 5300.0;
    parameter Real gK = 2700.0;
    parameter Real tau_n = 20.0;
    parameter Real gCa = 1000.0;
    parameter Real gkCa = 300.0;
    parameter Real kd = 0.5;
    parameter Real gkATP_ = 16000.0;
    parameter Real kGPDH = 0.0005;
    parameter Real bottom1 = 1.0;
    parameter Real weight1 = 1.0;
    parameter Real topa1 = 0.0;
    parameter Real k1 = 30.0;
    parameter Real k2 = 1.0;
    parameter Real k3 = 50000.0;
    parameter Real k4 = 220.0;
    parameter Real VmaxPFK = 5.0;
    parameter Real f13 = 0.02;
    parameter Real f43 = 20.0;
    parameter Real f23 = 0.2;
    parameter Real f42 = 20.0;
    parameter Real f41 = 20.0;
    parameter Real lambda = 0.06;
    parameter Real p1 = 400.0;
    parameter Real p2 = 1.0;
    parameter Real p3 = 0.01;
    parameter Real JGPDHbas = 0.0005;
    parameter Real p4 = 0.6;
    parameter Real p5 = 0.1;
    parameter Real p6 = 177.0;
    parameter Real p7 = 5.0;
    parameter Real NADmtot = 10.0;
    parameter Real Cmito = 1.8;
    parameter Real p8 = 7.0;
    parameter Real p9 = 0.1;
    parameter Real p10 = 177.0;
    parameter Real p11 = 5.0;
    parameter Real p13 = 10.0;
    parameter Real p14 = 190.0;
    parameter Real p15 = 8.5;
    parameter Real p16 = 35.0;
    parameter Real JGK = 0.4;
    parameter Real p17 = 0.002;
    parameter Real p18 = -0.03;
    parameter Real p19 = 0.35;
    parameter Real p20 = 2.0;
    parameter Real FRT = 0.037410133;
    parameter Real p21 = 0.04;
    parameter Real p22 = 1.1;
    parameter Real p23 = 0.01;
    parameter Real p24 = 0.016;
    parameter Real fmito = 0.01;
    parameter Real Amtot = 15.0;
    parameter Real khyd = 5e-05;
    parameter Real khydbas = 5e-05;
    parameter Real atot = 2500.0;
    parameter Real fcyt = 0.01;
    parameter Real kPMCA = 0.1;
    parameter Real alpha = 4.5e-06;
    parameter Real Cbas = 0.05;
    parameter Real pleak = 0.0002;
    parameter Real kSERCA = 0.4;
    parameter Real fer = 0.01;
    parameter Real Vc_Ver = 31.0;
    parameter Real gamma = 0.001;
    parameter Real kappa = 0.001;
    parameter Real VK = -75.0;
    parameter Real VCa = 25.0;
    parameter Real AMP = 500.0;
    parameter Real Compartment = 1.0;

    Real Ik(start=0.0);
    Real n_infinity(start=0.000150710358059757);
    Real Ica(start=-2927.84163162795);
    Real m_infinity(start=0.0344451956662112);
    Real Ikca(start=466.296163499462);
    Real Ikatp(start=2433.43025793791);
    Real katpo(start=0.010139292741408);
    Real topo(start=110.233638969723);
    Real bottomo(start=10871.9258612131);
    Real mgadp(start=187.605);
    Real adp3m(start=153.495);
    Real atp4m(start=68.15);
    Real JGPDH(start=0.000734846922834953);
    Real F6P(start=90.3);
    Real JPFK(start=0.374364085279846);
    Real JPFK_ms(start=0.000374364085279847);
    Real weight2(start=8444.40454545454);
    Real topa2(start=0.0);
    Real bottom2(start=8445.40454545454);
    Real topa3(start=0.1630818);
    Real weight3(start=0.1630818);
    Real bottom3(start=8445.56762725454);
    Real weight4(start=68.8564346600455);
    Real topa4(start=69.0195164600455);
    Real bottom4(start=8514.42406191459);
    Real weight5(start=2.16);
    Real topa5(start=69.0195164600455);
    Real bottom5(start=8516.58406191459);
    Real weight6(start=911.995690909091);
    Real topa6(start=69.0195164600455);
    Real bottom6(start=9428.57975282368);
    Real weight7(start=1.76128344);
    Real topa7(start=70.7807999000455);
    Real bottom7(start=9430.34103626368);
    Real weight8(start=37.1824747164245);
    Real topa8(start=107.96327461647);
    Real bottom8(start=9467.52351098011);
    Real weight9(start=16.6666666666667);
    Real topa9(start=107.96327461647);
    Real bottom9(start=9484.19017764677);
    Real weight10(start=7037.00378787879);
    Real topa10(start=107.96327461647);
    Real bottom10(start=16521.1939655256);
    Real weight11(start=135.9015);
    Real topa11(start=243.86477461647);
    Real bottom11(start=16657.0954655256);
    Real weight12(start=2869.01811083523);
    Real topa12(start=3112.8828854517);
    Real bottom12(start=19526.1135763608);
    Real weight13(start=36.0);
    Real topa13(start=3112.8828854517);
    Real bottom13(start=19562.1135763608);
    Real weight14(start=759.996409090909);
    Real topa14(start=3112.8828854517);
    Real bottom14(start=20322.1099854517);
    Real weight15(start=1467.7362);
    Real topa15(start=3112.8828854517);
    Real bottom15(start=21789.8461854517);
    Real weight16(start=1549.26977985102);
    Real topa16(start=4662.15266530272);
    Real bottom16(start=23339.1159653027);
    Real topb(start=1467.7362);
    Real JPDH(start=0.451601160351069);
    Real JO(start=0.446813558235194);
    Real NADm(start=9.6);
    Real JHres(start=5.21282484607726);
    Real JF1F0(start=1.12901593707623);
    Real JHatp(start=3.38704781122868);
    Real JGK_ms(start=0.0004);
    Real JHleak(start=0.298);
    Real JANT(start=1.1239508472473);
    Real RATm(start=0.351351351351351);
    Real Juni(start=0.157794);
    Real JNaCa(start=0.162244429551387);
    Real Jmito(start=0.00445042955138744);
    Real ATPm(start=3.9);
    Real Jhyd(start=0.0797355);
    Real atp(start=1363.0);
    Real Jmem(start=0.00117528734232577);
    Real Jleak(start=0.068966);
    Real JSERCA(start=0.068);
    Real Jer(start=0.000965999999999995);
    Real delta(start=0.0733082706766917);

    Real Vm;
    Real n;
    Real G6P;
    Real FBP;
    Real NADHm;
    Real delta_psi;
    Real Cam;
    Real ADPm;
    Real adp;
    Real c;
    Real Caer;

initial equation
    Vm = -60.0;
    n = 0.0;
    G6P = 301.0;
    FBP = 2.16;
    NADHm = 0.4;
    delta_psi = 164.0;
    Cam = 0.2;
    ADPm = 11.1;
    adp = 1137.0;
    c = 0.17;
    Caer = 345.0;

equation
    Ik = gK * n * (Vm - VK);
    n_infinity = 1 / (1 + exp(-(16 + Vm) / 5));
    m_infinity = 1 / (1 + exp(-(20 + Vm) / 12));
    Ica = gCa * m_infinity * (Vm - VCa);
    Ikca = gkCa * (pow(c, 2) / (pow(c, 2) + pow(kd, 2))) * (Vm - VK);
    mgadp = 0.165 * adp;
    topo = 0.08 * (1 + 2 * mgadp / 17) + 0.89 * pow(mgadp / 17, 2);
    adp3m = 0.135 * adp;
    JGPDH = kGPDH * pow(FBP, 1 / 2);
    F6P = 0.3 * G6P;
    topa2 = topa1;
    weight3 = pow(F6P, 2) / k3;
    topa3 = topa2 + weight3;
    weight5 = FBP / k2;
    weight7 = FBP * pow(F6P, 2) / (k2 * f23 * k3);
    weight9 = AMP / k1;
    weight11 = AMP * pow(F6P, 2) / (k1 * k3 * f13);
    weight13 = AMP * FBP / (k1 * k2);
    weight15 = AMP * FBP * pow(F6P, 2) / (k1 * k2 * f23 * f13 * k3);
    topb = weight15;
    JO = p4 * NADHm / (p5 + NADHm) / (1 + exp((delta_psi - p6) / p7));
    NADm = NADmtot - NADHm;
    JPDH = p1 / (p2 + NADHm / NADm) * (Cam / (p3 + Cam)) * (JGPDH + JGPDHbas);
    JHres = p8 * (NADHm / (p9 + NADHm)) * (1 / (1 + exp((delta_psi - p10) / p11)));
    JGK_ms = kappa * JGK;
    JHleak = p17 * delta_psi + p18;
    Juni = (p21 * delta_psi - p22) * pow(c, 2);
    JNaCa = p23 * (Cam / c) * exp(p24 * delta_psi);
    Jmito = JNaCa - Juni;
    ATPm = Amtot - ADPm;
    JF1F0 = p16 * p13 / (p13 + ATPm) * (1 / (1 + exp((p14 - delta_psi) / p15)));
    JHatp = 3 * JF1F0;
    RATm = ATPm / ADPm;
    JANT = p19 * (RATm / (RATm + p20)) * exp(0.5 * FRT * delta_psi);
    atp = atot - adp;
    atp4m = 0.05 * atp;
    bottomo = pow(1 + mgadp / 17, 2) * (1 + adp3m / 26 + atp4m / 1);
    katpo = topo / bottomo;
    Ikatp = gkATP_ * katpo * (Vm - VK);
    weight2 = pow(atp, 2) / k4;
    bottom2 = bottom1 + weight2;
    bottom3 = bottom2 + weight3;
    weight4 = pow(F6P * atp, 2) / (k3 * k4 * f43);
    topa4 = topa3 + weight4;
    bottom4 = bottom3 + weight4;
    topa5 = topa4;
    bottom5 = bottom4 + weight5;
    weight6 = FBP * pow(atp, 2) / (k2 * f42 * k4);
    topa6 = topa5;
    bottom6 = bottom5 + weight6;
    topa7 = topa6 + weight7;
    bottom7 = bottom6 + weight7;
    weight8 = FBP * pow(F6P, 2) * pow(atp, 2) / (k2 * f23 * f42 * f43 * k3 * k4);
    topa8 = topa7 + weight8;
    topa9 = topa8;
    bottom8 = bottom7 + weight8;
    bottom9 = bottom8 + weight9;
    weight10 = AMP * pow(atp, 2) / (k1 * k4 * f41);
    topa10 = topa9;
    bottom10 = bottom9 + weight10;
    topa11 = topa10 + weight11;
    bottom11 = bottom10 + weight11;
    weight12 = AMP * pow(F6P, 2) * pow(atp, 2) / (k1 * f13 * f41 * f43 * k3 * k4);
    topa12 = topa11 + weight12;
    bottom12 = bottom11 + weight12;
    topa13 = topa12;
    bottom13 = bottom12 + weight13;
    weight14 = AMP * FBP * pow(atp, 2) / (k1 * k2 * f42 * f41 * k4);
    topa14 = topa13;
    bottom14 = bottom13 + weight14;
    topa15 = topa14;
    bottom15 = bottom14 + weight15;
    weight16 = AMP * FBP * pow(F6P, 2) * pow(atp, 2) / (k1 * k2 * k3 * k4 * f23 * f13 * f42 * f41 * f43);
    topa16 = topa15 + weight16;
    bottom16 = bottom15 + weight16;
    JPFK = (VmaxPFK * lambda * topa16 + VmaxPFK * topb) / bottom16;
    JPFK_ms = kappa * JPFK;
    Jhyd = (khyd * c + khydbas) * atp;
    Jmem = -(alpha * Ica + kPMCA * (c - Cbas));
    Jleak = pleak * (Caer - c);
    JSERCA = kSERCA * c;
    Jer = Jleak - JSERCA;
    delta = 3.9 / 53.2;
    der(Vm) = -(Ik + Ica + Ikca + Ikatp) / cm;
    der(n) = (n_infinity - n) / tau_n;
    der(G6P) = JGK_ms - JPFK_ms;
    der(FBP) = JPFK_ms - 0.5 * JGPDH;
    der(NADHm) = gamma * (JPDH - JO);
    der(delta_psi) = (JHres - (JHatp + JANT + JHleak + JNaCa + 2 * Juni)) / Cmito;
    der(Cam) = -fmito * Jmito;
    der(ADPm) = gamma * (JANT - JF1F0);
    der(adp) = -delta * JANT + Jhyd;
    der(c) = fcyt * (Jmem + Jer + delta * Jmito);
    der(Caer) = -fer * Vc_Ver * Jer;




end BIOMD376;
