
model BIOMD373 "Bertram2004_PancreaticBetaCell_modelB"

    function pow
        input  Real x;
        input  Real power;
        output Real y;
        algorithm
            y := x^power;
    end pow;
    
    function piecewise
        input Real x;
        input Boolean condition;
        input Real y;
        output Real z;
        algorithm
            z := if condition then x else y;
    end piecewise;



    parameter Real Cm = 5300.0;
    parameter Real gK = 2700.0;
    parameter Real gKCa = 600.0;
    parameter Real kd = 0.5;
    parameter Real gCa = 1000.0;
    parameter Real VCa = 25.0;
    parameter Real taun = 20.0;
    parameter Real fcyt = 0.01;
    parameter Real fer = 0.01;
    parameter Real sigmaV = 31.0;
    parameter Real pleak = 0.0002;
    parameter Real Kserca = 0.4;
    parameter Real lambdaer = 1.0;
    parameter Real epser = 1.0;
    parameter Real alpha = 4.5e-06;
    parameter Real kpmca = 0.2;
    parameter Real Rgk = 0.2;
    parameter Real atot = 3000.0;
    parameter Real pfkbas = 0.06;
    parameter Real lambda = 0.005;
    parameter Real bottom1 = 1.0;
    parameter Real topa1 = 0.0;
    parameter Real k1 = 30.0;
    parameter Real k2 = 1.0;
    parameter Real k3 = 50000.0;
    parameter Real k4 = 1000.0;
    parameter Real cat = 2.0;
    parameter Real famp = 0.02;
    parameter Real fatp = 20.0;
    parameter Real ffbp = 0.2;
    parameter Real fbt = 20.0;
    parameter Real fmt = 20.0;
    parameter Real VK = -75.0;
    parameter Real gkatpbar = 25000.0;
    parameter Real kdd = 17.0;
    parameter Real ktd = 26.0;
    parameter Real ktt = 1.0;
    parameter Real taua = 300000.0;
    parameter Real r1 = 0.35;
    parameter Real r = 1.0;
    parameter Real vg = 2.2;
    parameter Real kg = 10.0;
    parameter Real COMpartment = 1.0;

    Real IK(start=1012.5);
    Real ICa(start=-2927.84163162795);
    Real IKCa(start=1800.0);
    Real minf(start=0.0344451956662112);
    Real ninf(start=0.000150710358059757);
    Real Jmem(start=-0.0368247126576742);
    Real Jer(start=-0.06305);
    Real Jserca(start=0.1);
    Real Jleak(start=0.03695);
    Real rgpdh(start=1.26491106406735);
    Real f6p(start=60.0);
    Real pfk(start=0.550829288131395);
    Real weight2(start=3609.03788460095);
    Real topa2(start=0.0);
    Real bottom2(start=3610.03788460095);
    Real topa3(start=0.072);
    Real weight3(start=0.072);
    Real bottom3(start=3610.10988460095);
    Real weight4(start=12.9925363845634);
    Real topa4(start=13.0645363845634);
    Real bottom4(start=3623.10242098551);
    Real weight5(start=40.0);
    Real topa5(start=13.0645363845634);
    Real bottom5(start=3663.10242098551);
    Real weight6(start=7218.07576920189);
    Real topa6(start=13.0645363845634);
    Real bottom6(start=10881.1781901874);
    Real weight7(start=14.4);
    Real topa7(start=27.4645363845634);
    Real bottom7(start=10895.5781901874);
    Real weight8(start=129.925363845634);
    Real topa8(start=157.389900230198);
    Real bottom8(start=11025.503554033);
    Real weight9(start=10.6751068378236);
    Real topa9(start=157.389900230198);
    Real bottom9(start=11036.1786608709);
    Real weight10(start=1926.34324999341);
    Real topa10(start=157.389900230198);
    Real bottom10(start=12962.5219108643);
    Real weight11(start=38.4303846161651);
    Real topa11(start=195.820284846363);
    Real bottom11(start=13000.9522954804);
    Real weight12(start=346.741784998813);
    Real topa12(start=542.562069845176);
    Real bottom12(start=13347.6940804792);
    Real weight13(start=427.004273512945);
    Real topa13(start=542.562069845176);
    Real bottom13(start=13774.6983539922);
    Real weight14(start=3852.68649998681);
    Real topa14(start=542.562069845176);
    Real bottom14(start=17627.384853979);
    Real weight15(start=7686.07692323301);
    Real topa15(start=542.562069845176);
    Real bottom15(start=25313.461777212);
    Real weight16(start=3467.41784998813);
    Real topa16(start=4009.9799198333);
    Real bottom16(start=28780.8796272001);
    Real topb(start=7686.07692323301);
    Real mgadp(start=128.7);
    Real adp3m(start=105.3);
    Real atp4m(start=94.9873397432646);
    Real topo(start=52.3005816608997);
    Real bottomo(start=7348.24106009167);
    Real katpo(start=0.00711742867894527);
    Real IKATP(start=2669.03575460448);
    Real atp(start=1899.74679486529);
    Real fback(start=1.24703296147847);
    Real y(start=0.247032961478473);
    Real amp(start=320.253205134709);
    Real rad(start=1579.49358973058);
    Real ratio(start=2.43557281392986);

    Real V;
    Real n;
    Real c;
    Real cer;
    Real g6p;
    Real fbp;
    Real adp;

initial equation
    V = -60.0;
    n = 0.025;
    c = 0.25;
    cer = 185.0;
    g6p = 200.0;
    fbp = 40.0;
    adp = 780.0;

equation
    IK = gK * n * (V - VK);
    IKCa = gKCa / (1 + pow(kd / c, 2)) * (V - VK);
    minf = 1 / (1 + exp(-(20 + V / 1) / 12));
    ICa = gCa * minf * (V - VCa);
    ninf = 1 / (1 + exp(-(16 + V / 1) / 5));
    Jmem = -(alpha * ICa + kpmca * c);
    Jserca = Kserca * c;
    Jleak = pleak * (cer - c);
    Jer = epser * (Jleak - Jserca) / lambdaer;
    rgpdh = 0.2 * pow(abs(fbp * 1 / pow(1, 2)), 1 / 2);
    f6p = 0.3 * g6p;
    topa2 = topa1;
    weight3 = pow(f6p, 2) / (k3 * 1);
    topa3 = topa2 + weight3;
    weight5 = fbp / k2;
    weight7 = fbp * pow(f6p, 2) / (k2 * k3 * ffbp * 1);
    mgadp = 0.165 * adp;
    adp3m = 0.135 * adp;
    topo = 0.08 * (1 + 2 * mgadp / (kdd * 1)) + 0.89 * pow(mgadp / (kdd * 1), 2);
    y = vg * (rgpdh / (kg + rgpdh));
    fback = r + y;
    rad = pow(abs(pow(adp - atot, 2) - 4 * pow(adp, 2)), 1 / 2) / 1;
    atp = 0.5 * (atot - adp + rad * 1);
    weight2 = pow(atp, 2) / (k4 * 1);
    bottom2 = bottom1 + weight2;
    bottom3 = bottom2 + weight3;
    weight4 = pow(f6p * atp, 2) / (fatp * k3 * k4 * pow(1, 2));
    topa4 = topa3 + weight4;
    bottom4 = bottom3 + weight4;
    topa5 = topa4;
    bottom5 = bottom4 + weight5;
    weight6 = fbp * pow(atp, 2) / (k2 * k4 * fbt * 1);
    topa6 = topa5;
    bottom6 = bottom5 + weight6;
    topa7 = topa6 + weight7;
    bottom7 = bottom6 + weight7;
    weight8 = fbp * pow(f6p, 2) * pow(atp, 2) / (k2 * k3 * k4 * ffbp * fbt * fatp * pow(1, 2));
    topa8 = topa7 + weight8;
    topa9 = topa8;
    bottom8 = bottom7 + weight8;
    topa10 = topa9;
    atp4m = 0.05 * atp;
    bottomo = pow(1 + mgadp / (kdd * 1), 2) * (1 + adp3m / (ktd * 1) + atp4m / (ktt * 1));
    katpo = topo / bottomo;
    IKATP = gkatpbar * katpo * (V - VK);
    amp = adp * adp / atp;
    weight9 = amp / k1;
    bottom9 = bottom8 + weight9;
    weight10 = amp * pow(atp, 2) / (k1 * k4 * fmt * 1);
    bottom10 = bottom9 + weight10;
    weight11 = amp * pow(f6p, 2) / (k1 * k3 * famp * 1);
    topa11 = topa10 + weight11;
    bottom11 = bottom10 + weight11;
    weight12 = amp * pow(f6p, 2) * pow(atp, 2) / (k1 * k3 * k4 * famp * fmt * fatp * pow(1, 2));
    topa12 = topa11 + weight12;
    bottom12 = bottom11 + weight12;
    weight13 = amp * fbp / (k1 * k2);
    topa13 = topa12;
    bottom13 = bottom12 + weight13;
    weight14 = amp * fbp * pow(atp, 2) / (k1 * k2 * k4 * fbt * fmt * 1);
    topa14 = topa13;
    bottom14 = bottom13 + weight14;
    weight15 = amp * fbp * pow(f6p, 2) / (k1 * k2 * k3 * ffbp * famp * 1);
    topa15 = topa14;
    bottom15 = bottom14 + weight15;
    weight16 = amp * fbp * pow(f6p, 2) * pow(atp, 2) / (k1 * k2 * k3 * k4 * ffbp * famp * fbt * fmt * fatp * pow(1, 2));
    topa16 = topa15 + weight16;
    bottom16 = bottom15 + weight16;
    topb = weight15;
    pfk = 1 * ((pfkbas * cat * topa16 + cat * topb) / bottom16);
    ratio = atp / adp;
    der(V) = -(IK + ICa + IKCa + IKATP) / Cm;
    der(n) = (ninf - n) / taun;
    der(c) = fcyt * (Jmem + Jer);
    der(cer) = -fer * sigmaV * Jer;
    der(g6p) = lambda * (Rgk - pfk);
    der(fbp) = lambda * (pfk / 1 - 0.5 * rgpdh);
    der(adp) = (atp - adp * exp(fback * (1 - c / r1))) / (taua * 1);




end BIOMD373;
