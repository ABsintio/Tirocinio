
model BIOMD356 "Nyman2011_M3Hierarachical_InsulinGlucosedynamics"

    function pow
        input  Real x;
        input  Real power;
        output Real y;
        algorithm
            y := x^power;
    end pow;
    
    function piecewise
        input Real x;
        input Boolean condition;
        input Real y;
        output Real z;
        algorithm
            z := if condition then x else y;
    end piecewise;



    parameter Real a1 = 448251462.71204;
    parameter Real a2 = 4321891.90327031;
    parameter Real d1 = 0.7722612342;
    parameter Real d2 = 0.0122057759;
    parameter Real Kcr = 0.0013640432;
    parameter Real Kex = 37.0818924842;
    parameter Real Kend = 30.6825110077;
    parameter Real Kdp = 0.0009500831;
    parameter Real Kcat = 237.5189220434;
    parameter Real Km = 3.0181933402;
    parameter Real kfbasal = 0.49752158;
    parameter Real krbasal = 128042.884096176;
    parameter Real k21 = 0.009645863;
    parameter Real k22 = 2374.9773277896;
    parameter Real k23 = 0.1199031163;
    parameter Real k24 = 0.9430860972;
    parameter Real k2b = 608.5839585406;
    parameter Real k3f = 8.1119350488;
    parameter Real k3b = 0.1895302156;
    parameter Real k4f = 384885.688277883;
    parameter Real k4b = 28137.0701606029;
    parameter Real k5f = 64300.0712750856;
    parameter Real k5b = 10052.5084521206;
    parameter Real k6f = 16094201.7926563;
    parameter Real k6b = 77.7712105485;
    parameter Real k7f = 4174.6300598327;
    parameter Real k7b = 565342.162392942;
    parameter Real k8f = 1515762.41887571;
    parameter Real k8b = 300.7511656484;
    parameter Real k91 = 8.14e-08;
    parameter Real k92 = 0.0280831426;
    parameter Real k9b = 4.0297596909;
    parameter Real k5Basic = 0.2040341054;
    parameter Real k5BasicWb = 2.34e-08;
    parameter Real k_glut4 = 31.4211308621;
    parameter Real k_glut1 = 0.2966651081;
    parameter Real KmG1 = 132.7704719106;
    parameter Real KmG4 = 70.4032025464;
    parameter Real kbf = 0.003119389367;
    parameter Real V_G = 1.88;
    parameter Real k_1 = 0.065;
    parameter Real k_2 = 0.079;
    parameter Real G_b = 95.0;
    parameter Real V_I = 0.05;
    parameter Real m_1 = 0.19;
    parameter Real m_2 = 0.484;
    parameter Real m_4 = 0.194;
    parameter Real m_5 = 0.0304;
    parameter Real m_6 = 0.6471;
    parameter Real HE_b = 0.6;
    parameter Real I_b = 25.0;
    parameter Real S_b = 1.8;
    parameter Real S_b_minus = -1.8;
    parameter Real k_max = 0.0558;
    parameter Real k_min = 0.008;
    parameter Real k_abs = 0.057;
    parameter Real k_gri = 0.0558;
    parameter Real f = 0.9;
    parameter Real b = 0.82;
    parameter Real d = 0.01;
    parameter Real BW = 78.0;
    parameter Real k_p1 = 2.7;
    parameter Real k_p2 = 0.0021;
    parameter Real k_p3 = 0.009;
    parameter Real k_p4 = 0.0618;
    parameter Real k_i = 0.0079;
    parameter Real U_ii = 1.0;
    parameter Real V_m0 = 2.5;
    parameter Real V_mX = 0.047;
    parameter Real K_m0 = 225.59;
    parameter Real p_2U = 0.0331;
    parameter Real part = 0.2;
    parameter Real K = 2.3;
    parameter Real alpha = 0.05;
    parameter Real beta = 0.11;
    parameter Real gamma = 0.5;
    parameter Real k_e1 = 0.0005;
    parameter Real k_e2 = 339.0;
    parameter Real D = 78000.0;
    parameter Real default = 1.0;

    Real vglucoseuptake(start=0.0);
    Real KD(start=0.0);
    Real S2(start=0.0);
    Real S1(start=0.0);
    Real K4(start=0.0);
    Real K8(start=0.0);
    Real aa(start=0.0);
    Real cc(start=0.0);
    Real EGP(start=0.0);
    Real V_mmax(start=0.0);
    Real E(start=0.0);
    Real S(start=0.0);
    Real I(start=0.0);
    Real G(start=0.0);
    Real HE(start=0.0);
    Real m_3(start=0.0);
    Real Q_sto(start=0.0);
    Real Ra(start=0.0);
    Real k_empt(start=0.0);
    Real U_idm(start=0.0);
    Real U_id(start=0.0);
    Real U(start=0.0);
    Real S_po(start=0.0);
    Real G_p(start=178.0);
    Real G_t(start=135.0);
    Real I_l(start=4.5);
    Real I_p(start=1.25);
    Real Q_sto1(start=78000.0);
    Real Q_sto2(start=0.0);
    Real Q_gut(start=0.0);
    Real I_1(start=25.0);
    Real I_d(start=25.0);
    Real INS(start=0.0);
    Real I_po(start=3.6);
    Real Y(start=0.0);

    Real r0;
    Real r1;
    Real r2;
    Real r11;
    Real r12;
    Real r22;
    Real r1x2;
    Real r11x2;
    Real r1x22;
    Real r1x22d;
    Real r11x22;
    Real rend;
    Real rendP;
    Real iendIR;
    Real iend;
    Real rPbasal;
    Real IRS;
    Real IRSiP;
    Real X;
    Real X_P;
    Real PI3K;
    Real PI3K_;
    Real PDK1;
    Real PDK1_;
    Real PKC;
    Real PKC_P;
    Real PKB;
    Real PKB_P;
    Real mTOR;
    Real mTOR_;
    Real GLUT4_C;
    Real GLUT4_M;

initial equation
    r0 = 9.96820379306998;
    r1 = 0.0221366043399864;
    r2 = 0.00934921094738169;
    r11 = 1.22886711962222e-05;
    r12 = 1.0376421415741e-05;
    r22 = 2.18683301945588e-06;
    r1x2 = 1.36475817837692e-06;
    r11x2 = 1.51513915390766e-09;
    r1x22 = 6.39351849488596e-10;
    r1x22d = 5.59231079319369e-20;
    r11x22 = 1.78725515332219e-14;
    rend = 3.31711803810961e-05;
    rendP = 0.000212533941418487;
    iendIR = 7.25519178924707e-06;
    iend = 1.13228497567934e-06;
    rPbasal = 3.87230309356247e-05;
    IRS = 9.99982253600007;
    IRSiP = 0.000177463999892648;
    X = 9.92463241634744;
    X_P = 0.0753675836525682;
    PI3K = 9.97578356966623;
    PI3K_ = 0.0242164303337614;
    PDK1 = 8.65876984730663;
    PDK1_ = 1.34123015269338;
    PKC = 3.60283594102724e-05;
    PKC_P = 9.99996397164059;
    PKB = 9.90193143617302;
    PKB_P = 0.0980685638269942;
    mTOR = 0.0201915011292933;
    mTOR_ = 9.97980849887072;
    GLUT4_C = 9.99316830771855;
    GLUT4_M = 0.00683169228144988;

equation
    vglucoseuptake = k_glut1 * G_t / (KmG1 + G_t) + k_glut4 * GLUT4_M * G_t / (KmG4 + G_t) + kbf * (INS + 5);
    KD = 7e-6;
    S2 = 0;
    S1 = (INS + 5) * 1e-12;
    K4 = 1400;
    K8 = 0.01;
    aa = 5 / 2 / (1 - b) / D;
    cc = 5 / 2 / d / D;
    EGP = k_p1 - k_p2 * G_p - k_p3 * I_d - k_p4 * I_po;
    V_mmax = (1 - part) * (V_m0 + V_mX * INS);
    E = 0;
    S = gamma * I_po;
    I = I_p / V_I;
    G = G_p / V_G;
    HE = -m_5 * S + m_6;
    m_3 = HE * m_1 / (1 - HE);
    Q_sto = Q_sto1 + Q_sto2;
    Ra = f * k_abs * Q_gut / BW;
    k_empt = k_min + (k_max - k_min) / 2 * (tanh(aa * (Q_sto - b * D)) - tanh(cc * (Q_sto - d * D)) + 2);
    U_idm = V_mmax * G_t / (K_m0 + G_t);
    U_id = U_idm + vglucoseuptake;
    U = U_ii + U_id;
    S_po = Y + K * (EGP + Ra - E - U_ii - k_1 * G_p + k_2 * G_t) / V_G + S_b;
    der(G_p) = EGP + Ra - E - U_ii - k_1 * G_p + k_2 * G_t;
    der(G_t) = -U_id + k_1 * G_p - k_2 * G_t;
    der(I_l) = -m_1 * I_l - m_3 * I_l + m_2 * I_p + S;
    der(I_p) = -m_2 * I_p - m_4 * I_p + m_1 * I_l;
    der(Q_sto1) = -k_gri * Q_sto1;
    der(Q_sto2) = -k_empt * Q_sto2 + k_gri * Q_sto1;
    der(Q_gut) = -k_abs * Q_gut + k_empt * Q_sto2;
    der(I_1) = -k_i * (I_1 - I);
    der(I_d) = -k_i * (I_d - I_1);
    der(INS) = -p_2U * INS + p_2U * (I - I_b);
    der(I_po) = -gamma * I_po + S_po;
    der(Y) = -alpha * (Y - beta * (G - G_b));
    der(r0) = (d1 * r1) + (d2 * r2) + (Kex * rend) + (krbasal * rPbasal) - (2 * a1 * S1 * r0) - (2 * a2 * S1 * r0) - (kfbasal * r0);
    der(r1) = (2 * a1 * S1 * r0) + (2 * d1 * r11) + (d2 * r12) + (d2 * r1x2) - (a1 * S1 * r1) - (d1 * r1) - (a2 * S1 * r1) - (Kcr * r1);
    der(r2) = (2 * a2 * S1 * r0) + (d1 * r12) + (2 * d2 * r22) + (d1 * r1x2) - (a1 * S1 * r2) - (a2 * S1 * r2) - (d2 * r2) - (Kcr * r2);
    der(r11) = (a1 * S1 * r1) + (d2 * r11x2) - (2 * d1 * r11) - (2 * Kcr * r11);
    der(r12) = (a1 * S1 * r2) + (a2 * S1 * r1) + (d2 * r1x22) + (d1 * r11x2) - (d1 * r12) - (d2 * r12) - (Kcr * r12) - (Kcr * r12);
    der(r22) = (a2 * S1 * r2) + (d1 * r1x22) - (2 * d2 * r22) - (2 * Kcr * r22);
    der(r1x2) = (Kcr * r1) + (Kcr * r2) + (d1 * r11x2) + (d2 * r1x22) + (d2 * r1x22d) - (a1 * S1 * r1x2) - (a2 * S1 * r1x2) - (d2 * r1x2) - (d1 * r1x2) - (a2 * S2 * r1x2) - (Kend * r1x2);
    der(r11x2) = (a1 * S1 * r1x2) + (2 * Kcr * r11) + (Kcr * r12) + (d2 * r11x22) - (d1 * r11x2) - (d2 * r11x2) - (d1 * r11x2) - (a2 * S1 * r11x2) - (Kend * r11x2);
    der(r1x22) = (a2 * S1 * r1x2) + (Kcr * r12) + (2 * Kcr * r22) + (K8 * r1x22d) + (d1 * r11x22) - (d2 * r1x22) - (d2 * r1x22) - (d1 * r1x22) - (a1 * S1 * r1x22) - (K4 * S1 * r1x22) - (Kend * r1x22);
    der(r1x22d) = (a2 * S2 * r1x2) + (K4 * S1 * r1x22) - (K8 * r1x22d) - (d2 * r1x22d) - (Kend * r1x22d);
    der(r11x22) = (a1 * S1 * r1x22) + (a2 * S1 * r11x2) - (d1 * r11x22) - (d2 * r11x22) - (Kend * r11x22);
    der(rend) = ((Kdp + Kcat * X_P / (Km + X_P)) * rendP) - (Kex * rend);
    der(rendP) = (Kend * r1x2) + (Kend * r11x2) + (Kend * r1x22) + (Kend * r1x22d) + (Kend * r11x22) + (Kend * rPbasal) - ((Kdp + Kcat * X_P / (Km + X_P)) * rendP);
    der(iendIR) = (Kend * r1x2) + (2.0 * Kend * r11x2) + (2.0 * Kend * r1x22) + (3.0 * Kend * r1x22d) + (3.0 * Kend * r11x22) - ((Kdp + Kcat * X_P / (Km + X_P)) * iendIR);
    der(iend) = ((Kdp + Kcat * X_P / (Km + X_P)) * iendIR) - (Kex * iend);
    der(rPbasal) = (kfbasal * r0) - (krbasal * rPbasal) - (Kend * rPbasal);
    der(IRS) = (k2b * IRSiP) - (k21 * IRS * (r1x2 + r11x2 + r1x22 + r1x22d + r11x22 + rPbasal + k22 * rendP) * (1 + k23 * PKC_P + k24 * mTOR));
    der(IRSiP) = (k21 * IRS * (r1x2 + r11x2 + r1x22 + r1x22d + r11x22 + rPbasal + k22 * rendP) * (1 + k23 * PKC_P + k24 * mTOR)) - (k2b * IRSiP);
    der(X) = (k3b * X_P) - (k3f * X * IRSiP);
    der(X_P) = (k3f * X * IRSiP) - (k3b * X_P);
    der(PI3K) = (k4b * PI3K_) - (k4f * PI3K * IRSiP);
    der(PI3K_) = (k4f * PI3K * IRSiP) - (k4b * PI3K_);
    der(PDK1) = (k5b * PDK1_) - (k5f * PDK1 * PI3K_);
    der(PDK1_) = (k5f * PDK1 * PI3K_) - (k5b * PDK1_);
    der(PKC) = (k6b * PKC_P) - (k6f * PKC * PDK1_);
    der(PKC_P) = (k6f * PKC * PDK1_) - (k6b * PKC_P);
    der(PKB) = (k7b * PKB_P) - (k7f * PKB * PDK1_);
    der(PKB_P) = (k7f * PKB * PDK1_) - (k7b * PKB_P);
    der(mTOR) = (k8b * mTOR_) - (k8f * mTOR * PKB_P);
    der(mTOR_) = (k8f * mTOR * PKB_P) - (k8b * mTOR_);
    der(GLUT4_C) = (k9b * GLUT4_M) - (k91 * GLUT4_C * PKC_P + k92 * GLUT4_C * PKB_P + k5BasicWb * GLUT4_C);
    der(GLUT4_M) = (k91 * GLUT4_C * PKC_P + k92 * GLUT4_C * PKB_P + k5BasicWb * GLUT4_C) - (k9b * GLUT4_M);




end BIOMD356;
